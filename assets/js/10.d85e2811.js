(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{337:function(e,t,n){"use strict";n.r(t);var o=n(18),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"room-cleanup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#room-cleanup"}},[e._v("#")]),e._v(" Room Cleanup")]),e._v(" "),n("p",[e._v("Destroyer2 automatically lets open rooms expire after a specified time to keep\nthe database clean. The expiration time in seconds can be set with the\n"),n("code",[e._v("EXPIRE_ROOMS")]),e._v(" key in the "),n("code",[e._v(".env")]),e._v(" file. The default is after 1 day. See the\n"),n("a",{attrs:{href:"./customizing#environment"}},[e._v("customizing section")]),e._v(" for more information on\navailable environment variables.")]),e._v(" "),n("p",[e._v("Waiting users in an expired room are kicked out. However, rooms never expire\nwhen they are full.")]),e._v(" "),n("p",[e._v("Cleaning up closed rooms in the game-server and the "),n("code",[e._v("openrooms")]),e._v(" list used to\ntrack currently playable rooms is a little more difficult. Destroyer2 uses a\nmultipronged approach to this problem.")]),e._v(" "),n("h2",{attrs:{id:"passive-cleanup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#passive-cleanup"}},[e._v("#")]),e._v(" Passive Cleanup")]),e._v(" "),n("p",[e._v("Expired rooms are deleted from the "),n("code",[e._v("openrooms")]),e._v(" list when this list is read. This\nmeans that calls to the "),n("code",[e._v("api/openrooms")]),e._v(" "),n("a",{attrs:{href:"./api#open-rooms"}},[e._v("endpoint")]),e._v(" clean up\nexpired but still visible zombie rooms.")]),e._v(" "),n("p",[e._v("However, as this endpoint is cached using the "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Modified-Since",target:"_blank",rel:"noopener noreferrer"}},[e._v("If-Modified-Since"),n("OutboundLink")],1),e._v(" header, only new users\npassively clean up zombie rooms. This means that existing users might join such\na room, cleaning up the room but causing a user-unfriendly connection error.")]),e._v(" "),n("h2",{attrs:{id:"aggressive-cleanup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#aggressive-cleanup"}},[e._v("#")]),e._v(" Aggressive Cleanup")]),e._v(" "),n("p",[e._v("Aggressive cleanup is an optional cleanup mode, where the server actively tries\nto clean up zombie rooms before a users receive an unfriendly error. This\nconsumes a little more ressources.")]),e._v(" "),n("p",[e._v("Aggressive cleanup offers two modes to actively remove expired rooms:")]),e._v(" "),n("ul",[n("li",[e._v("A "),n("strong",[e._v("regular cleanup")]),e._v(" that calls the "),n("a",{attrs:{href:"./api#open-rooms"}},[n("code",[e._v("openrooms")])]),e._v("\nendpoint at regular intervals without cache to activate passive cleanup.\nThis mode can be enabled with the "),n("code",[e._v("CLEANUP_INTERVAL")]),e._v(" key in the "),n("code",[e._v(".env")]),e._v(" file,\nspecifying the interval in seconds, in which the endpoint should be called.")])]),e._v(" "),n("p",[e._v("OR")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("A "),n("strong",[e._v("notification listener mode")]),e._v(" that activates Redis\n"),n("a",{attrs:{href:"https://redis.io/topics/notifications",target:"_blank",rel:"noopener noreferrer"}},[e._v("keyspace-event"),n("OutboundLink")],1),e._v(" listeners to clean\nup expired rooms as soon as they are closed. This mode can be activated by\nsetting the "),n("code",[e._v("AGGRESSIVE_CLEANUP")]),e._v(" value in the "),n("code",[e._v(".env")]),e._v(" to "),n("code",[e._v("true")]),e._v(".")]),e._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),n("p",[e._v("Keyspace-event listeners are only available since Redis 2.8.0 and might not\nwork in every environment such as Heroku.")])])])])])}),[],!1,null,null,null);t.default=s.exports}}]);